<div class="form-container">
  <h2>Add Merchant</h2>

  <form [formGroup]="addMerchantForm" (ngSubmit)="onSubmit()">
    <div class="form-row">
      <div class="form-group">
        <label for="storeName">Store Name</label>
        <input type="text" id="storeName" formControlName="storeName" required>
      </div>
      <div class="form-group">
        <label for="userName">Username</label>
        <input type="text" id="userName" formControlName="userName" required>
      </div>
      <div class="form-group">
        <label for="passwordHash">Password</label>
        <input type="password" id="passwordHash" formControlName="passwordHash" required>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" formControlName="email" required>
      </div>
      <div class="form-group">
        <label for="address">Address</label>
        <input type="text" id="address" formControlName="address" required>
      </div>
      <div class="form-group">
        <label for="phoneNumber">Phone</label>
        <input type="text" id="phoneNumber" formControlName="phoneNumber" required>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label for="governorateID">Governorate</label>
        <select id="governorateID" formControlName="governorateID" required>
          <option *ngFor="let governorate of governorates" [value]="governorate.id">{{ governorate.name }}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="cityID">City</label>
        <select id="cityID" formControlName="cityID" required>
          <option *ngFor="let city of cities" [value]="city.id">{{ city.name }}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="branchID">Branch</label>
        <select id="branchID" formControlName="branchID" required>
          <option *ngFor="let branch of branches" [value]="branch.id">{{ branch.name }}</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label for="specialPickupShippingCost">Special Pickup Cost</label>
        <input type="number" id="specialPickupShippingCost" formControlName="specialPickupShippingCost" required>
      </div>
      <div class="form-group">
        <label for="merchantPayingPercentageForRejectedOrders">Merchant Paying Percentage for Rejected Orders
          (%)</label>
        <input type="number" id="merchantPayingPercentageForRejectedOrders"
          formControlName="merchantPayingPercentageForRejectedOrders" required>
      </div>
    </div>

    <div class="form-group">
      <p class="text">Special price packages</p>
    </div>
    <div class="table-container">
      <table class="product-table">
        <thead>
          <tr>
            <th>Governorate</th>
            <th>City</th>
            <th>Shipping Price</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody>
          <!-- Iterate over existing data -->
          <tr *ngFor="let package of displaySpecialPackage; let i = index">
            <td>{{ package.governorateName }}</td>
            <td>{{ package.cityName }}</td>
            <td>{{ package.shippingPrice }}</td>
            <td class="settings">
              <button type="button" class="setting" (click)="deleteSpecialPackage(i)">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
          <!-- Conditionally display the new package fields -->
          <tr *ngIf="addSpecialPackage" [formGroup]="newPackageForm">
            <td>
              <div class="form-group">
                <select class="form-control" formControlName="governorateId" required>
                  <option *ngFor="let governorate of governorates" [value]="governorate.id">{{ governorate.name }}
                  </option>
                </select>
              </div>
            </td>
            <td>
              <div class="form-group">
                <select class="form-control" formControlName="cityId" required>
                  <option *ngFor="let city of cities" [value]="city.id">{{ city.name }}</option>
                </select>
              </div>
            </td>
            <td>
              <div class="form-group">
                <input type="number" class="form-control" formControlName="shippingPrice" required>
              </div>
            </td>
            <td>
              <button type="button" class="setting2" (click)="saveSpecialPackage()">
                <i class="bi bi-check-lg"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Button to add new row -->
    <div class="form-row add-button-container">
      <button type="button" class="add-new-btn" [ngClass]="{'cancel-btn': addSpecialPackage}"
        (click)="toggleAddNewPackage()">
        {{ addSpecialPackage ? 'Cancel' : 'Add New' }} <i class="bi bi-plus-lg" *ngIf="!addSpecialPackage"></i><i
          class="bi bi-x-lg" *ngIf="addSpecialPackage"></i>
      </button>
    </div>

    <!-- Save button for the form -->
    <div class="form-row save-button-container mb-0">
      <button type="submit" class="save-btn">Save Merchant <i class="bi bi-check-lg"></i></button>
    </div>
  </form>
</div>